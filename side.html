<html>
<head>
	<meta charset="utf-8">
    <title>Side</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
        }
        canvas {
			margin: auto;
			display: block;
			margin-top: 50px;
		}
    </style>
    <script src="pixi.js"></script>
    <script src="keyboard.js"></script>
    
    <script src="level0MapData.js"></script>
    
    <script src="utils.game.js"></script>
    <script src="viewport.game.js"></script>
    
    <script src="backgroundScroller.game.js"></script>
    <script src="levelMap.game.js"></script>
    <script src="character.game.js"></script>
    
</head>
<body>
    <script>
		
		/* Init game elements */
		var stage = new PIXI.Stage(0xFFF);
		var renderer = PIXI.autoDetectRenderer(
			Defaults.stageSize[0] * Defaults.stageMap.unitSize[0],
			Defaults.stageSize[1] * Defaults.stageMap.unitSize[1]
		);
		document.body.appendChild(renderer.view);
	 
		var bgScroller = new BackgroundScroller(stage);
		var levelMap = new LevelMap(stage);
		var player = new Character();
		stage.addChild( player );
		
		/* Keyboard handling */
		KeyboardJS.on("right", function() {
			viewport.direction.x = 1;
			player.direction.x = 1;
		}, function() {
			if( viewport.direction.x === 1 ) {
				viewport.direction.x = 0;
			}
			if( player.direction.x === 1 ) {
				player.direction.x = 0;
			}
		});
		
		KeyboardJS.on("left", function() {
			viewport.direction.x = -1;
			player.direction.x = -1;
		}, function() {
			if( viewport.direction.x === -1 ) {
				viewport.direction.x = 0;
			}
			if( player.direction.x === -1 ) {
				player.direction.x = 0;
			}
		});
		
		KeyboardJS.on("up", function() {
			if( player.getAction() != "fall" ) {
				player.setAction("jump");
			}
			
		}, function() {
			
		});
		
		/* Start game loop */
		requestAnimFrame( animate );
	 
		function animate() {
			requestAnimFrame( animate );

			viewport.update();
			
			player.update(levelMap);
			
			renderer.render(stage);
		}
 
    </script>
 
    </body>
</html>
